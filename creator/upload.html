<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DearViewr Studio ‚Äì Upload</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: #fff;
}

header {
  padding: 15px;
  background: #181818;
  font-size: 20px;
  font-weight: bold;
}

.container {
  max-width: 700px;
  margin: 30px auto;
  padding: 20px;
}

.type-badge {
  display: inline-block;
  padding: 6px 12px;
  background: linear-gradient(45deg,#ff0050,#00f2ea);
  border-radius: 20px;
  font-size: 13px;
  margin-bottom: 15px;
}

.box {
  border: 2px dashed #333;
  padding: 30px;
  text-align: center;
  margin-bottom: 20px;
}

input, textarea {
  width: 100%;
  margin: 10px 0;
  padding: 10px;
  background: #121212;
  border: 1px solid #333;
  color: #fff;
}

button {
  width: 100%;
  padding: 15px;
  background: red;
  border: none;
  color: white;
  font-size: 16px;
  cursor: pointer;
}

#progress {
  height: 5px;
  background: #333;
  margin-top: 15px;
}

#progressBar {
  height: 5px;
  width: 0%;
  background: red;
}

.preview {
  margin-bottom: 15px;
}

.preview video,
.preview img {
  max-width: 100%;
  border-radius: 10px;
}
</style>
</head>

<body>

<header>DearViewr Studio</header>

<div class="container">

  <div id="uploadType" class="type-badge">Detecting...</div>

  <div class="preview" id="preview"></div>

  <div class="box">
    <input type="file" id="videoFile" accept="image/*,video/*">
    <p id="fileName">No file selected</p>
  </div>

  <label>Title</label>
  <input type="text" id="title" placeholder="Enter title">

  <label>Description</label>
  <textarea id="desc" rows="4" placeholder="Description"></textarea>

  <button onclick="startUpload()">UPLOAD</button>

  <div id="progress">
    <div id="progressBar"></div>
  </div>

  <p id="status"></p>

</div>

<script>
const token = localStorage.getItem("access_token");
if (!token) location.href = "/auth/login.html";

const uploadType = sessionStorage.getItem("upload_type");
const uploadTypeEl = document.getElementById("uploadType");
const preview = document.getElementById("preview");
const fileInput = document.getElementById("videoFile");
const fileName = document.getElementById("fileName");

let selectedFile = null;

/* ================= TYPE DETECT ================= */

if (uploadType === "reel") {
  uploadTypeEl.innerText = "üé¨ Reel (Vertical Video)";
} else if (uploadType === "video") {
  uploadTypeEl.innerText = "üì∫ Normal Video";
} else if (uploadType === "image") {
  uploadTypeEl.innerText = "üñº Image Post";
} else {
  uploadTypeEl.innerText = "üì§ Upload Content";
}

/* ================= FILE PREVIEW ================= */

fileInput.addEventListener("change", function () {
  const file = this.files[0];
  if (!file) return;

  selectedFile = file;
  fileName.innerText = file.name;
  preview.innerHTML = "";

  if (file.type.startsWith("image/")) {
    const img = document.createElement("img");
    img.src = URL.createObjectURL(file);
    preview.appendChild(img);
  } else if (file.type.startsWith("video/")) {
    const video = document.createElement("video");
    video.src = URL.createObjectURL(file);
    video.controls = true;
    preview.appendChild(video);
  }
});

/* ================= START UPLOAD ================= */

async function startUpload() {
  if (!selectedFile) {
    alert("Select file first");
    return;
  }

  const formData = new FormData();
  formData.append("file", selectedFile);
  formData.append("title", document.getElementById("title").value);
  formData.append("description", document.getElementById("desc").value);
  formData.append("video_type", uploadType || "video");

  const xhr = new XMLHttpRequest();
  xhr.open("POST", "/api/upload/", true);
  xhr.setRequestHeader("Authorization", "Bearer " + token);

  xhr.upload.onprogress = function (e) {
    if (e.lengthComputable) {
      const percent = (e.loaded / e.total) * 100;
      document.getElementById("progressBar").style.width = percent + "%";
    }
  };

  xhr.onload = function () {
    if (xhr.status === 200) {
      document.getElementById("status").innerText = "Upload success ‚úÖ";
      sessionStorage.removeItem("upload_type");
    } else {
      document.getElementById("status").innerText = "Upload failed ‚ùå";
    }
  };

  xhr.send(formData);
}
</script>

</body>
</html>
